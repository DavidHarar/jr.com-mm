#!/usr/bin/env bash
set -e # halt script on error

# network environment info
curl -s http://whatismyip.akamai.com | xargs echo "IP: "
dig whoami.akamai.net +short | xargs echo "whoami: "

# see PATH variables for debugging
echo $PATH

bundle config git.allow_insecure true
bundle exec jekyll b -c _config.yml

# External Link checking only
# bundle exec htmlproofer ./_site --disable-external --alt-ignore '/.*/' --allow-hash-href true

# External Link and image checking
# bundle exec htmlproofer ./_site/ --alt-ignore '/.*/' --allow-hash-href true --http-status-ignore 0,301,302,403,999 --check-img-http

# External Link, image, and HTTPS checking
#bundle exec htmlproofer ./_site/ --alt-ignore '/.*/' --allow-hash-href --check-html --check-img-http --check-opengraph --http-status-ignore 0,403,999
bundle exec htmlproofer ./_site/ --allow-hash-href --check-html --check-img-http --check-opengraph --empty-alt-ignore --url-swap "http\://localhost\:4000:https://www.justinrummel.com" --file-ignore '/search/' --http-status-ignore 999

